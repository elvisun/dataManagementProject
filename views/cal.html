<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
<style>

.chord {
  fill-opacity: .67;
}

</style>
<body>
<div class="container">
  <!-- Static navbar -->
  <nav class="navbar navbar-toggleable-md navbar-light bg-faded">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Carpool Database</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="/">Home</a></li>
          <li><a href="/calendar">Calendar View</a></li>
          <li><a href="/histogram">Histogram</a></li>
          <li><a href="/questions">Questions</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
  </nav>
</div>


<div class="container">
  <div class="row">
    <div id="key" class="col-mid-10 col-md-offset-1">
      <script src="https://d3js.org/d3.v4.min.js"></script>
      <script>

      var width = 960,
          height = 136,
          cellSize = 17;

      var formatPercent = d3.format(".1%");

      var color = d3.scaleQuantize()
          .domain([-0.05, 0.05])
          .range(["#a50026", "#d73027", "#f46d43", "#fdae61", "#fee08b", "#ffffbf", "#d9ef8b", "#a6d96a", "#66bd63", "#1a9850", "#006837"]);

      var svg = d3.select("#key")
        .selectAll("svg")
        .data(d3.range(1990, 2011))
        .enter().append("svg")
          .attr("width", width)
          .attr("height", height)
        .append("g")
          .attr("transform", "translate(" + ((width - cellSize * 53) / 2) + "," + (height - cellSize * 7 - 1) + ")");

      svg.append("text")
          .attr("transform", "translate(-6," + cellSize * 3.5 + ")rotate(-90)")
          .attr("font-family", "sans-serif")
          .attr("font-size", 10)
          .attr("text-anchor", "middle")
          .text(function(d) { return d; });

      var rect = svg.append("g")
          .attr("fill", "none")
          .attr("stroke", "#ccc")
        .selectAll("rect")
        .data(function(d) { return d3.timeDays(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
        .enter().append("rect")
          .attr("width", cellSize)
          .attr("height", cellSize)
          .attr("x", function(d) { return d3.timeWeek.count(d3.timeYear(d), d) * cellSize; })
          .attr("y", function(d) { return d.getDay() * cellSize; })
          .datum(d3.timeFormat("%Y-%m-%d"));

      svg.append("g")
          .attr("fill", "none")
          .attr("stroke", "#000")
        .selectAll("path")
        .data(function(d) { return d3.timeMonths(new Date(d, 0, 1), new Date(d + 1, 0, 1)); })
        .enter().append("path")
          .attr("d", pathMonth);

      d3.csv("dji.csv", function(error, csv) {
        if (error) throw error;

        var data = d3.nest()
            .key(function(d) { return d.Date; })
            .rollup(function(d) { return (d[0].Close - d[0].Open) / d[0].Open; })
          .object(csv);

        rect.filter(function(d) { return d in data; })
            .attr("fill", function(d) { return color(data[d]); })
          .append("title")
            .text(function(d) { return d + ": " + formatPercent(data[d]); });
      });

      function pathMonth(t0) {
        var t1 = new Date(t0.getFullYear(), t0.getMonth() + 1, 0),
            d0 = t0.getDay(), w0 = d3.timeWeek.count(d3.timeYear(t0), t0),
            d1 = t1.getDay(), w1 = d3.timeWeek.count(d3.timeYear(t1), t1);
        return "M" + (w0 + 1) * cellSize + "," + d0 * cellSize
            + "H" + w0 * cellSize + "V" + 7 * cellSize
            + "H" + w1 * cellSize + "V" + (d1 + 1) * cellSize
            + "H" + (w1 + 1) * cellSize + "V" + 0
            + "H" + (w0 + 1) * cellSize + "Z";
      }

      </script>

    </div>
  </div>
</div>



</body>

